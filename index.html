<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TrueTrend — Download</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="TrueTrend installer download." />
  <style>
    :root { --brand:#0c1324; }
    body{font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#222;margin:0;background:#fff}
    .wrap{max-width:840px;margin:48px auto;padding:0 24px}
    h1{font-size:32px;margin:0 0 8px}
    .muted{color:#666}
    .card{border:1px solid #eee;border-radius:16px;padding:20px;margin-top:24px;box-shadow:0 5px 18px rgba(16,24,40,.04)}
    .btn{display:inline-block;background:#16a34a;color:#fff;padding:14px 20px;border-radius:12px;text-decoration:none;font-weight:600}
    .btn:hover{filter:brightness(.95)}
    .btn.secondary{background:#0c1324}
    .hidden{display:none}
    .stack{display:flex;gap:12px;flex-wrap:wrap}
    .ok{color:#16a34a}
    .err{color:#dc2626}
    .center{text-align:center}
    .mt16{margin-top:16px}
    .mt24{margin-top:24px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>TrueTrend</h1>
    <p class="muted">Router-based trading assistant.</p>

    <!-- PURCHASE -->
    <div class="card">
      <h2>Get TrueTrend</h2>
      <p>Select a plan and complete checkout. After payment you’ll be sent back here and your download will start automatically.</p>
      <div class="stack mt16">
        <!-- Your two Stripe Payment Links -->
        <a class="btn" href="https://buy.stripe.com/fZueVd0nPgU4dzvfkW38401" target="_blank" rel="noopener">Buy Link A</a>
        <a class="btn secondary" href="https://buy.stripe.com/fZu4gzc6x47i3YV3Ce38408" target="_blank" rel="noopener">Buy Link B</a>
      </div>
    </div>

    <!-- THANK YOU / DOWNLOAD -->
    <div id="thanks" class="card hidden">
      <h2 class="ok">Thanks — your payment succeeded!</h2>
      <p>Starting your download… If it doesn’t start automatically, click the button below.</p>
      <p class="mt16"><a id="manualLink" class="btn" href="#">Download Installer</a></p>
      <p class="muted mt16">If you have any trouble, contact support and we’ll sort it out quickly.</p>
    </div>

    <!-- FALLBACK ERROR -->
    <div id="oops" class="card hidden">
      <h2 class="err">We couldn’t start the download</h2>
      <p>Please use the button above or try again.</p>
    </div>

    <!-- (Optional) footer -->
    <p class="center muted mt24">© <span id="y"></span> TrueTrend</p>
  </div>

  <script>
    // 1) Configure the exact path to your zip at the repo root
    //    If you renamed the file, update this path:
    const FILE_PATH = "/releases/TrueTrend_Installer_v4.3.3.5.zip";

    // 2) Utility: read query parameter
    const params = new URLSearchParams(location.search);
    const isThanks = params.get("thanks") === "1";

    // Show current year
    document.getElementById('y').textContent = new Date().getFullYear();

    function startDownload() {
      // Attempt a programmatic download
      const link = document.createElement('a');
      link.href = FILE_PATH;
      link.download = "";
      document.body.appendChild(link);
      link.click();
      link.remove();
    }

    function headCheck(url, timeout = 4000) {
      return new Promise((resolve, reject) => {
        const ctrl = new AbortController();
        const id = setTimeout(() => { ctrl.abort(); reject(new Error('timeout')) }, timeout);
        fetch(url, { method: 'HEAD', signal: ctrl.signal })
          .then(r => { clearTimeout(id); r.ok ? resolve() : reject(new Error(r.status)) })
          .catch(e => { clearTimeout(id); reject(e) })
      });
    }

    (function init() {
      if (!isThanks) return; // normal homepage

      // Show Thank You block
      document.getElementById('thanks').classList.remove('hidden');
      const manual = document.getElementById('manualLink');
      manual.href = FILE_PATH;

      // Try download after a short delay
      setTimeout(() => {
        headCheck(FILE_PATH, 5000)
          .then(() => startDownload())
          .catch(() => {
            document.getElementById('oops').classList.remove('hidden');
          });
      }, 900);
    })();
  </script>
</body>
</html>
